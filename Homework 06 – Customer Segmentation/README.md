# BADS7105-CRM-analytics-and-intelligence

## Customer Single View
'''SELECT CUST_CODE, 
COUNT(BASKET_ID) AS BASKET_COUNT,
AVG(TOTAL_AMOUNT) AS TICKET_SIZE,
MIN(TOTAL_AMOUNT) AS MIN_SIZE,
MAX(TOTAL_AMOUNT) AS MAX_SIZE,
STDDEV(TOTAL_AMOUNT) AS STD_SIZE,
AVG(TOTAL_PRODUCT) AS AVG_PRODUCT_BASKET,
COUNT(IF(BASKET_SIZE ='L', BASKET_SIZE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_SIZE_L, 
COUNT(IF(BASKET_SIZE ='M', BASKET_SIZE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_SIZE_M, 
COUNT(IF(BASKET_SIZE ='S', BASKET_SIZE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_SIZE_S, 
COUNT(IF(BASKET_PRICE_SENSITIVITY ='LA', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_PRICE_SENSITIVITY_LA, 
COUNT(IF(BASKET_PRICE_SENSITIVITY ='MM', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_PRICE_SENSITIVITY_MM, 
COUNT(IF(BASKET_PRICE_SENSITIVITY ='UM', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_PRICE_SENSITIVITY_UM, 
COUNT(IF(BASKET_PRICE_SENSITIVITY ='XX', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_PRICE_SENSITIVITY_XX,
COUNT(IF(BASKET_TYPE ='Small Shop', BASKET_TYPE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_TYPE_Small_Shop, 
COUNT(IF(BASKET_TYPE ='Top Up', BASKET_TYPE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_TYPE_Top_Up, 
COUNT(IF(BASKET_TYPE ='Full Shop', BASKET_TYPE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_TYPE_Full_Shop, 
COUNT(IF(BASKET_TYPE ='XX', BASKET_TYPE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_TYPE_XX,
COUNT(IF(BASKET_DOMINANT_MISSION ='Fresh', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_DOMINANT_MISSION_Fresh, 
COUNT(IF(BASKET_DOMINANT_MISSION ='Grocery', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_DOMINANT_MISSION_Grocery, 
COUNT(IF(BASKET_DOMINANT_MISSION ='Mixed', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_DOMINANT_MISSION_Mixed, 
COUNT(IF(BASKET_DOMINANT_MISSION ='Non Food', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_DOMINANT_MISSION_Non_Food,
DATE(CAST (SUBSTR(CAST (MIN(SHOP_DATE) AS STRING) ,0,4) AS INT64),CAST (SUBSTR(CAST (MIN(SHOP_DATE) AS STRING),5,2) AS INT64),CAST (SUBSTR(CAST (MIN(SHOP_DATE) AS STRING),7,2) AS INT64)) AS FIRST_DATE,
DATE(CAST (SUBSTR(CAST (MAX(SHOP_DATE) AS STRING) ,0,4) AS INT64),CAST (SUBSTR(CAST (MAX(SHOP_DATE) AS STRING),5,2) AS INT64),CAST (SUBSTR(CAST (MAX(SHOP_DATE) AS STRING),7,2) AS INT64)) AS LAST_DATE,
DATE_DIFF(DATE "2008-07-06",DATE(CAST (SUBSTR(CAST (MAX(SHOP_DATE) AS STRING) ,0,4) AS INT64),CAST (SUBSTR(CAST (MAX(SHOP_DATE) AS STRING),5,2) AS INT64),CAST (SUBSTR(CAST (MAX(SHOP_DATE) AS STRING),7,2) AS INT64)),DAY) AS MISS_DAY,
COUNT(IF((SHOP_WEEKDAY =1 OR SHOP_WEEKDAY =7), SHOP_WEEKDAY, null))/COUNT(BASKET_ID) AS COUNT_WEEKEND,
COUNT(IF((SHOP_WEEKDAY !=1 AND SHOP_WEEKDAY !=7), SHOP_WEEKDAY, null))/COUNT(BASKET_ID) AS COUNT_WEEKDAY,
COUNT(DISTINCT SHOP_WEEK) AS WEEK_COUNT,
COUNT(IF(SHOP_HOUR =8, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_8,
COUNT(IF(SHOP_HOUR =9, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_9,
COUNT(IF(SHOP_HOUR =10, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_10,
COUNT(IF(SHOP_HOUR =11, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_11,
COUNT(IF(SHOP_HOUR =12, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_12,
COUNT(IF(SHOP_HOUR =13, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_13,
COUNT(IF(SHOP_HOUR =14, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_14,
COUNT(IF(SHOP_HOUR =15, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_15,
COUNT(IF(SHOP_HOUR =16, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_16,
COUNT(IF(SHOP_HOUR =17, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_17,
COUNT(IF(SHOP_HOUR =18, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_18,
COUNT(IF(SHOP_HOUR =19, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_19,
COUNT(IF(SHOP_HOUR =20, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_20,
COUNT(IF(SHOP_HOUR =21, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_21,
FROM `bads-7105.dunnhumby_data.basket_view`
GROUP BY CUST_CODE'''
