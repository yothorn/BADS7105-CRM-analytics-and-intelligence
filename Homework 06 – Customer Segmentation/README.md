# BADS7105-CRM-analytics-and-intelligence

## Customer Single View
<img width="1139" alt="image" src="https://user-images.githubusercontent.com/76954323/126772971-52d15912-95cb-414a-b8b3-ae79eebd7379.png">

```
SELECT CUST_CODE, 
COUNT(BASKET_ID) AS BASKET_COUNT,
AVG(TOTAL_AMOUNT) AS TICKET_SIZE,
MIN(TOTAL_AMOUNT) AS MIN_SIZE,
MAX(TOTAL_AMOUNT) AS MAX_SIZE,
STDDEV(TOTAL_AMOUNT) AS STD_SIZE,
AVG(TOTAL_PRODUCT) AS AVG_PRODUCT_BASKET,
COUNT(IF(BASKET_SIZE ='L', BASKET_SIZE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_SIZE_L, 
COUNT(IF(BASKET_SIZE ='M', BASKET_SIZE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_SIZE_M, 
COUNT(IF(BASKET_SIZE ='S', BASKET_SIZE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_SIZE_S, 
COUNT(IF(BASKET_PRICE_SENSITIVITY ='LA', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_PRICE_SENSITIVITY_LA, 
COUNT(IF(BASKET_PRICE_SENSITIVITY ='MM', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_PRICE_SENSITIVITY_MM, 
COUNT(IF(BASKET_PRICE_SENSITIVITY ='UM', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_PRICE_SENSITIVITY_UM, 
COUNT(IF(BASKET_PRICE_SENSITIVITY ='XX', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_PRICE_SENSITIVITY_XX,
COUNT(IF(BASKET_TYPE ='Small Shop', BASKET_TYPE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_TYPE_Small_Shop, 
COUNT(IF(BASKET_TYPE ='Top Up', BASKET_TYPE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_TYPE_Top_Up, 
COUNT(IF(BASKET_TYPE ='Full Shop', BASKET_TYPE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_TYPE_Full_Shop, 
COUNT(IF(BASKET_TYPE ='XX', BASKET_TYPE, null))/COUNT(BASKET_ID) AS COUNT_BASKET_TYPE_XX,
COUNT(IF(BASKET_DOMINANT_MISSION ='Fresh', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_DOMINANT_MISSION_Fresh, 
COUNT(IF(BASKET_DOMINANT_MISSION ='Grocery', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_DOMINANT_MISSION_Grocery, 
COUNT(IF(BASKET_DOMINANT_MISSION ='Mixed', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_DOMINANT_MISSION_Mixed, 
COUNT(IF(BASKET_DOMINANT_MISSION ='Non Food', BASKET_PRICE_SENSITIVITY, null))/COUNT(BASKET_ID) AS COUNT_BASKET_DOMINANT_MISSION_Non_Food,
MIN(SHOP_DATE_1)AS FIRST_DATE,
MAX(SHOP_DATE_1) AS LAST_DATE,
DATE_DIFF(DATE "2008-07-06",MAX(SHOP_DATE_1),DAY) AS MISS_LAST_DATE_DAY,
MIN(MISSING_DATE_DAY) AS MIN_MISS_DATE_DAY,
MAX(MISSING_DATE_DAY) AS MAX_MISS_DATE_DAY,
STDDEV(MISSING_DATE_DAY) AS STD_MISS_DATE_DAY,
COUNT(IF((SHOP_WEEKDAY =1 OR SHOP_WEEKDAY =7), SHOP_WEEKDAY, null))/COUNT(BASKET_ID) AS COUNT_WEEKEND,
COUNT(IF((SHOP_WEEKDAY !=1 AND SHOP_WEEKDAY !=7), SHOP_WEEKDAY, null))/COUNT(BASKET_ID) AS COUNT_WEEKDAY,
COUNT(DISTINCT SHOP_WEEK) AS WEEK_COUNT,
COUNT(IF(SHOP_HOUR =8, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_8,
COUNT(IF(SHOP_HOUR =9, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_9,
COUNT(IF(SHOP_HOUR =10, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_10,
COUNT(IF(SHOP_HOUR =11, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_11,
COUNT(IF(SHOP_HOUR =12, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_12,
COUNT(IF(SHOP_HOUR =13, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_13,
COUNT(IF(SHOP_HOUR =14, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_14,
COUNT(IF(SHOP_HOUR =15, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_15,
COUNT(IF(SHOP_HOUR =16, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_16,
COUNT(IF(SHOP_HOUR =17, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_17,
COUNT(IF(SHOP_HOUR =18, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_18,
COUNT(IF(SHOP_HOUR =19, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_19,
COUNT(IF(SHOP_HOUR =20, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_20,
COUNT(IF(SHOP_HOUR =21, SHOP_HOUR, null))/COUNT(BASKET_ID) AS COUNT_SHOP_HOUR_21,
FROM `bads-7105.dunnhumby_data.basket_view_2`
GROUP BY CUST_CODE
```

## Segmentation

### By Visit View
<img width="1270" alt="image" src="https://user-images.githubusercontent.com/76954323/126773504-cbab072b-ebd4-4949-af83-19b594aabf31.png">

```
CREATE OR REPLACE MODEL
`bads-7105.dunnhumby_data.yo_cluster_visit`
OPTIONS (
MODEL_TYPE = 'KMEANS',
NUM_CLUSTERS = 7 )
AS (
SELECT COUNT_WEEKEND, 
COUNT_WEEKDAY, 
COUNT_SHOP_HOUR_8, 
COUNT_SHOP_HOUR_9, 
COUNT_SHOP_HOUR_10, 
COUNT_SHOP_HOUR_11, 
COUNT_SHOP_HOUR_12, 
COUNT_SHOP_HOUR_13, 
COUNT_SHOP_HOUR_14, 
COUNT_SHOP_HOUR_15, 
COUNT_SHOP_HOUR_16, 
COUNT_SHOP_HOUR_17, 
COUNT_SHOP_HOUR_18, 
COUNT_SHOP_HOUR_19, 
COUNT_SHOP_HOUR_20, 
COUNT_SHOP_HOUR_21
FROM `bads-7105.dunnhumby_data.cust_single_view`)
```

### By Spend View
<img width="1327" alt="image" src="https://user-images.githubusercontent.com/76954323/126773648-2cd89b15-1b45-4dce-82b7-a6336628f975.png">

```
CREATE OR REPLACE MODEL
`bads-7105.dunnhumby_data.yo_cluster_basket`
OPTIONS (
MODEL_TYPE = 'KMEANS',
NUM_CLUSTERS = 7 )
AS (
SELECT COUNT_BASKET_SIZE_L, 
COUNT_BASKET_SIZE_M, 
COUNT_BASKET_SIZE_S, 
COUNT_BASKET_PRICE_SENSITIVITY_LA, 
COUNT_BASKET_PRICE_SENSITIVITY_MM, 
COUNT_BASKET_PRICE_SENSITIVITY_UM, 
COUNT_BASKET_PRICE_SENSITIVITY_XX, 
COUNT_BASKET_TYPE_Small_Shop, 
COUNT_BASKET_TYPE_Top_Up,
COUNT_BASKET_TYPE_Full_Shop, 
COUNT_BASKET_TYPE_XX, 
COUNT_BASKET_DOMINANT_MISSION_Fresh, 
COUNT_BASKET_DOMINANT_MISSION_Grocery, 
COUNT_BASKET_DOMINANT_MISSION_Mixed, 
COUNT_BASKET_DOMINANT_MISSION_Non_Food
FROM `bads-7105.dunnhumby_data.cust_single_view`)
```

### By Basket View
<img width="1212" alt="image" src="https://user-images.githubusercontent.com/76954323/126773719-133f102a-642f-4395-bd19-3418b68e3b12.png">

```
CREATE OR REPLACE MODEL
`bads-7105.dunnhumby_data.yo_cluster_spend`
OPTIONS (
MODEL_TYPE = 'KMEANS',
NUM_CLUSTERS = 7 )
AS (
SELECT BASKET_COUNT, 
TOTAL_AMOUNT, 
TICKET_SIZE, 
MIN_SIZE, 
MAX_SIZE, 
STD_SIZE, 
AVG_PRODUCT_BASKET, 
COUNT_PROD, 
MAX_SPEND, 
MIN_SPEND, 
MAX_PRICE, 
MIN_PRICE, 
MAX_PRICE_SENS
FROM `bads-7105.dunnhumby_data.cust_single_view`)
```
